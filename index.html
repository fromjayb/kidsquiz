<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#1f53ff" />
  <title>역사 인물 퀴즈</title>
  <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#f6f8ff;
      --panel:#ffffff;
      --ink:#0b1220;
      --muted:#475569;
      --accent:#2563eb;
      --accent-weak:#e6efff;
      --accent-strong:#1d4ed8;
      --danger:#d92d20;
      --ring:0 0 0 3px rgba(37,99,235,.22);
      --radius:14px;
      --shadow:0 10px 28px rgba(15,23,42,.08);
      --ok-bg:#e8f0ff;
      --ok-bd:#adc4ff;
      --ok-ink:#1a4be0;
      --no-bg:#ffe9e9;
      --no-bd:#ffc7c7;
      --no-ink:#b42318;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;background:var(--bg);color:var(--ink);
      font-family:"Nanum Gothic",system-ui,-apple-system,Segoe UI,Roboto,Arial,"Apple SD Gothic Neo",sans-serif;
      line-height:1.6;
      -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;
      padding:env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
    }
    .container{max-width:420px;margin:0 auto;padding:16px}
    .card{
      background:var(--panel);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      border:1px solid #e9eeff;
      padding:16px;
    }
    header{display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:4px}
    .title{font-size:20px;font-weight:800;letter-spacing:-.2px}
    .badge{background:var(--accent-weak);color:var(--accent-strong);font-weight:800;border-radius:999px;padding:6px 10px;font-size:11px}
    .attempts{color:var(--muted);font-size:12px}
    .attempts strong{color:var(--danger)}

    .hero{display:flex;flex-direction:column;gap:12px;text-align:center;padding:6px 4px}
    .hero .big{font-size:18px;font-weight:800}
    .hero .small{font-size:13px;color:var(--muted)}
    .divider{height:1px;background:#e6ebff;margin:12px 0}

    .btn{
      border:0;border-radius:12px;
      padding:14px 14px;min-height:46px;
      font-weight:800;font-size:16px;line-height:1;
      cursor:pointer;width:100%;
      touch-action:manipulation;
    }
    .btn:focus{outline:none;box-shadow:var(--ring)}
    .btn-primary{background:var(--accent);color:#fff}
    .btn-ghost{background:#eff3ff;color:#0b1a2b}
    .btn-danger{background:#fee4e2;color:#b42318}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    .row>.btn{flex:1 1 auto}

    .progress{display:flex;align-items:center;justify-content:space-between;color:var(--muted);font-size:13px;margin:4px 0 8px}
    .q-title{font-size:17px;font-weight:800;margin:6px 0 8px}

    input[type="text"]{
      width:100%;padding:14px 12px;border:1px solid #d6e1ff;border-radius:12px;
      outline:none;font-size:16px;background:#fff;
    }
    input[type="text"]:focus{box-shadow:var(--ring);border-color:#b7cdff}

    .hintBox{
      background:#f7faff;border:1px solid #e2eaff;border-radius:12px;padding:10px 12px;
      white-space:pre-line;word-break:keep-all;
    }
    .hintItem{margin:4px 0}
    .hintItem.correct{background:var(--ok-bg);border:1px solid var(--ok-bd);padding:8px 10px;border-radius:10px;color:var(--ok-ink);font-weight:800}
    .hintItem.wrong{background:var(--no-bg);border:1px solid var(--no-bd);padding:8px 10px;border-radius:10px;color:var(--no-ink);font-weight:800}

    .footer-note{margin-top:8px;text-align:center;color:var(--muted);font-size:12px}

    /* Next 버튼은 액션 버튼 바로 아래에 고정(비-sticky) */
    #nextRow .btn{min-height:48px;font-size:17px}
    .error{margin-top:8px;color:#b42318;font-size:12px}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
  </style>
</head>
<body>
  <div class="container">
    <!-- HOME -->
    <section id="home" class="card">
      <header>
        <div class="title">역사 인물 퀴즈</div>
        <div class="badge" id="levelBadge">LEVEL 1</div>
      </header>
      <div class="attempts">남은 기회: <strong id="attemptsText">3</strong>회</div>
      <div class="hero">
        <div class="big">어려운 힌트에서 시작해<br>점점 쉬워지는 힌트로 정답을 맞혀보세요</div>
        <div class="small">
          각 레벨 10문제 · 70% 이상이면 다음 레벨<br>
          실패 시 기회 1회 차감(최대 3회)
        </div>
        <div class="divider"></div>
        <button class="btn btn-primary" id="startBtn" type="button">시작하기</button>
        <button class="btn btn-ghost" id="howBtn" type="button">게임 방법</button>
      </div>
    </section>

    <!-- HOW -->
    <section id="how" class="card" style="display:none">
      <header>
        <div class="title">게임 방법</div>
        <div class="badge" id="liveLevelHow">LEVEL 1</div>
      </header>
      <div class="hero" style="gap:10px">
        <div class="small" style="text-align:left">
          • 각 레벨은 10문제입니다.<br>
          • 정답 7개(70%) 이상이면 다음 레벨로 이동합니다.<br>
          • 틀리면 레벨 종료 시 기회가 1회 줄어듭니다(총 3회).<br>
          • 문제마다 기본 힌트가 1개 보이고, ‘힌트 더 보기’를 누를 때마다 힌트가 1개씩 추가됩니다.<br>
          • ‘스킵(정답 보기)’을 누르면 정답을 확인하고 다음 문제로 넘어갑니다(오답 처리).
        </div>
        <div class="row">
          <button class="btn btn-ghost" id="backHomeBtn1" type="button">처음으로</button>
          <button class="btn btn-primary" id="startBtn2" type="button">바로 시작</button>
        </div>
      </div>
    </section>

    <!-- QUIZ -->
    <section id="quiz" class="card" style="display:none">
      <header>
        <div class="title">문제 풀기</div>
        <div class="badge" id="liveLevel">LEVEL 1</div>
      </header>
      <div class="progress">
        <div id="progress">문제 1 / 10</div>
        <div class="attempts">남은 기회: <strong id="attemptsText2">3</strong>회</div>
      </div>
      <div class="q-title">이 사람은 누구일까요?</div>
      <div class="hintBox" id="hintBox"></div>
      <div class="row" style="margin-top:10px">
        <input id="answerInput" type="text" placeholder="정답 입력(예: 세종대왕)" autocomplete="off" />
      </div>
      <div class="row" style="margin-top:8px" id="actionRow">
        <button class="btn btn-primary" id="submitBtn" type="button">정답 제출</button>
        <button class="btn btn-ghost" id="moreHintBtn" type="button">힌트 더 보기</button>
        <button class="btn btn-ghost" id="skipBtn" type="button">스킵(정답 보기)</button>
      </div>
      <div class="row" id="nextRow" style="margin-top:8px; display:none">
        <button class="btn btn-primary" id="nextBtn" type="button">다음 문제</button>
      </div>
      <div id="err" class="error" aria-live="polite"></div>
    </section>

    <!-- RESULT -->
    <section id="result" class="card" style="display:none">
      <header>
        <div class="title" id="resultTitle">레벨 결과</div>
        <div class="badge" id="liveLevelRes">LEVEL 1</div>
      </header>
      <div class="hero" style="gap:10px">
        <div class="small" id="resultDesc">정답 0/10</div>
        <div class="row" id="resultBtns">
          <button class="btn btn-ghost" id="retryBtn" type="button">같은 레벨 다시</button>
          <button class="btn btn-primary" id="nextLevelBtn" type="button" style="display:none">다음 레벨로</button>
          <button class="btn btn-ghost" id="homeBtn" type="button">처음으로</button>
        </div>
      </div>
    </section>

    <div class="footer-note">© 2025 Kids History Studio</div>
  </div>

  <script>
    'use strict';
    // --------- 유틸 ---------
    const $ = (s)=>document.querySelector(s);
    const show = (el)=>{ if(el) el.style.display="block"; };
    const hide = (el)=>{ if(el) el.style.display="none"; };
    const shuffle = (arr)=>arr.map(v=>[Math.random(),v]).sort((a,b)=>a[0]-b[0]).map(v=>v[1]);
    const norm = (s)=> (s||"").toString().trim().toLowerCase().replace(/\s+/g,'').replace(/[^a-z0-9가-힣]/g,'');
    const on = (el, ev, fn)=> el && el.addEventListener(ev, (e)=>{ try{ fn(e); }catch(err){ showError(err); } }, {passive:true});

    // --------- 사운드 ---------
    let ACTX = null, AUDIO_UNLOCKED = false;
    function ensureAudio(){
      if(AUDIO_UNLOCKED) return;
      const Ctx = window.AudioContext || window.webkitAudioContext;
      if(!Ctx) return;
      if(!ACTX) ACTX = new Ctx();
      if(ACTX.state === 'suspended'){ ACTX.resume(); }
      AUDIO_UNLOCKED = true;
    }
    function tone({freq=440, type='sine', dur=0.2, gain=0.12, when=0}){
      if(!ACTX) return;
      const t0 = ACTX.currentTime + when;
      const osc = ACTX.createOscillator();
      const amp = ACTX.createGain();
      osc.type = type;
      osc.frequency.setValueAtTime(freq, t0);
      amp.gain.setValueAtTime(0.0001, t0);
      amp.gain.exponentialRampToValueAtTime(gain, t0+0.01);
      amp.gain.exponentialRampToValueAtTime(0.0001, t0+dur);
      osc.connect(amp).connect(ACTX.destination);
      osc.start(t0);
      osc.stop(t0+dur+0.02);
    }
    function playCorrect(){ ensureAudio(); tone({freq:523.25,type:'sine',dur:0.14,gain:0.12}); tone({freq:659.25,type:'sine',dur:0.16,gain:0.12,when:0.08}); tone({freq:783.99,type:'sine',dur:0.18,gain:0.12,when:0.16}); tone({freq:1174.66,type:'triangle',dur:0.16,gain:0.10,when:0.24}); }
    function playWrong(){ ensureAudio(); tone({freq:220,type:'square',dur:0.22,gain:0.10}); tone({freq:180,type:'sawtooth',dur:0.24,gain:0.09,when:0.06}); tone({freq:140,type:'square',dur:0.26,gain:0.09,when:0.12}); if(navigator.vibrate){ navigator.vibrate(140); } }
    function playClick(){ ensureAudio(); tone({freq:440,type:'triangle',dur:0.08,gain:0.08}); }
    function playLevelUp(){ ensureAudio(); tone({freq:392,type:'sine',dur:0.14,gain:0.12}); tone({freq:523.25,type:'sine',dur:0.16,gain:0.12,when:0.12}); tone({freq:659.25,type:'sine',dur:0.18,gain:0.12,when:0.24}); tone({freq:783.99,type:'sine',dur:0.2,gain:0.12,when:0.38}); tone({freq:1046.5,type:'triangle',dur:0.26,gain:0.11,when:0.56}); }

    // --------- 데이터 ---------
    const LEVELS = {
      1: [
        {answer:"세종대왕", alts:["세종"], hints:["집현전을 설치해 학문을 장려한 조선의 군주.","농사직설·칠정산 같은 실용서를 편찬 지원.","훈민정음을 창제했다."]},
        {answer:"이순신", alts:["충무공"], hints:["임진왜란 시기 조선 수군 지휘관.","학익진 전법을 구사했다.","명량·한산도 대첩의 주역."]},
        {answer:"김구", alts:["백범"], hints:["대한민국 임시정부 주석을 지낸 독립운동가.","호는 ‘백범’.","『백범일지』의 저자."]},
        {answer:"안중근", alts:[], hints:["연해주 일대에서 활동한 독립운동가.","왼손 무명지 첫마디를 끊는 단지를 했다.","하얼빈에서 이토 히로부미를 사살."]},
        {answer:"유관순", alts:[], hints:["만세운동으로 유명한 여성 독립운동가.","천안 아우네 장터와 관련 있다.","3·1운동의 상징적 인물."]},
        {answer:"장영실", alts:[], hints:["과학·기술에 뛰어난 조선의 장인.","자격루·앙부일구 제작에 참여.","세종의 총애를 받았다."]},
        {answer:"신사임당", alts:[], hints:["조선 중기의 여성 예술가.","초충도로 유명하다.","이이의 어머니."]},
        {answer:"광개토대왕", alts:["광개토"], hints:["영토 확장으로 이름난 고구려의 왕.","비가 만주 집안에 세워져 있다.","연호는 ‘영락’."]},
        {answer:"장보고", alts:[], hints:["해상 무역으로 이름난 인물.","청해진 설치와 관련 있다.","통일신라 시대 사람."]},
        {answer:"이и", alts:["율곡","율곡이이","이이"], hints:["조선의 성리학자이자 개혁론자.","만언봉사로 개혁안을 제시.","호는 ‘율곡’."]}
      ],
      2: [
        {answer:"정약용", alts:["다산"], hints:["실학자이자 기술서 저술가.","강진 유배 중 학문을 심화.","『목민심서』·『경세유표』."]},
        {answer:"허준", alts:[], hints:["의학에 큰 업적을 남긴 인물.","광해군 때 활동.","『동의보감』."]},
        {answer:"김정호", alts:[], hints:["조선 후기 지리·지도 제작자.","대축척 지도를 만들었다.","『대동여지도』."]},
        {answer:"을지문덕", alts:[], hints:["수 전쟁에서 활약한 장군.","살수대첩과 관련.","고구려의 명장."]},
        {answer:"이황", alts:["퇴계"], hints:["조선 중기의 성리학자.","도산서원을 세웠다.","호는 ‘퇴계’."]},
        {answer:"김좌진", alts:[], hints:["독립군 지휘관.","청산리 전투의 주역.","대한독립군 총사령관."]},
        {answer:"신채호", alts:[], hints:["역사학자이자 독립운동가.","고대사 연구와 민족주의 사학.","“역사는 아와 비아의 투쟁”"]},
        {answer:"선덕여왕", alts:["선덕"], hints:["삼국시대 여성 통치자.","첨성대와 관련 있다.","신라 제27대 왕."]},
        {answer:"신윤복", alts:["혜원"], hints:["풍속화를 많이 그린 화가.","호는 ‘혜원’.","『미인도』."]},
        {answer:"최무선", alts:[], hints:["화약·화포 도입에 기여.","왜구 격퇴에 활용.","고려 말 기술자."]}
      ]
      /* 레벨 3~5는 동일 데이터로 필요 시 확장 가능 */
    };

    // --------- 상태 ---------
    let level = 1;
    let attempts = 3;
    let revivedUsed = false;
    let quizOrder = [];
    let qIndex = 0;
    let correct = 0;
    let hintIndex = 0;
    let TOTAL = 10;

    // --------- 요소 ---------
    const secHome = $("#home"), secHow=$("#how"), secQuiz=$("#quiz"), secResult=$("#result");
    const levelBadge=$("#levelBadge"), attemptsText=$("#attemptsText");
    const liveLevel=$("#liveLevel"), attemptsText2=$("#attemptsText2");
    const liveLevelHow=$("#liveLevelHow"), liveLevelRes=$("#liveLevelRes");
    const progressEl=$("#progress"), hintBox=$("#hintBox");
    const answerInput=$("#answerInput");
    const startBtn=$("#startBtn"), startBtn2=$("#startBtn2"), howBtn=$("#howBtn");
    const backHomeBtn1=$("#backHomeBtn1"), backHomeBtn2=$("#backHomeBtn2"), homeBtn=$("#homeBtn");
    const submitBtn=$("#submitBtn"), moreHintBtn=$("#moreHintBtn"), skipBtn=$("#skipBtn"), nextBtn=$("#nextBtn");
    const actionRow=$("#actionRow"), nextRow=$("#nextRow"), retryBtn=$("#retryBtn"), nextLevelBtn=$("#nextLevelBtn");
    const resultTitle=$("#resultTitle"), resultDesc=$("#resultDesc");
    const errorBox=$("#err");

    // --------- 화면 ---------
    function setBadges(){
      levelBadge && (levelBadge.textContent = `LEVEL ${level}`);
      liveLevel && (liveLevel.textContent = `LEVEL ${level}`);
      liveLevelHow && (liveLevelHow.textContent = `LEVEL ${level}`);
      liveLevelRes && (liveLevelRes.textContent = `LEVEL ${level}`);
      attemptsText && (attemptsText.textContent = attempts);
      attemptsText2 && (attemptsText2.textContent = attempts);
    }
    function showScreen(name){
      hide(secHome); hide(secHow); hide(secQuiz); hide(secResult);
      if(name==="home") show(secHome);
      if(name==="how") show(secHow);
      if(name==="quiz") show(secQuiz);
      if(name==="result") show(secResult);
      setBadges();
    }
    function showError(err){
      console.error(err);
      if(errorBox){
        errorBox.textContent = "오류가 발생했습니다: " + (err && err.message ? err.message : String(err));
      }
    }

    // --------- 시작 ---------
    function safeStart(){
      playClick();
      if(attempts<=0){ tryRevive(); if(attempts<=0) return; }
      startLevel(level);
    }

    on(startBtn, "click", safeStart);
    on(startBtn2, "click", safeStart);
    on(howBtn, "click", ()=> { playClick(); showScreen("how"); });
    on(backHomeBtn1, "click", ()=> { playClick(); showScreen("home"); });
    on(backHomeBtn2, "click", ()=> { playClick(); showScreen("home"); });
    on(homeBtn, "click", ()=> { playClick(); showScreen("home"); });
    on(retryBtn, "click", ()=> { playClick(); if(attempts<=0){ tryRevive(); if(attempts<=0) return; } startLevel(level); });
    on(nextLevelBtn, "click", ()=> { playClick(); if(attempts<=0){ tryRevive(); if(attempts<=0) return; } startLevel(level); });

    on(submitBtn, "click", onSubmit);
    on(moreHintBtn, "click", ()=>{ playClick(); showNextHintOneByOne(); });
    on(skipBtn, "click", ()=>{ playClick(); onSkip(); });
    on(nextBtn, "click", ()=>{ playClick(); nextQuestion(); });
    on(answerInput, "keydown", (e)=>{ if(e.key==="Enter") onSubmit(); });

    function startLevel(lv){
      errorBox && (errorBox.textContent = "");
      level = lv;
      correct = 0;
      qIndex = 0;
      const pool = LEVELS[level] ? [...LEVELS[level]] : [];
      if(pool.length === 0){ showError(new Error("레벨 데이터가 없습니다.")); return; }
      TOTAL = Math.min(10, pool.length);
      quizOrder = shuffle(pool).slice(0, TOTAL);
      showScreen("quiz");
      renderQuestion();
    }

    function renderQuestion(){
      const q = quizOrder[qIndex];
      if(!q){ finishLevel(); return; }
      progressEl && (progressEl.textContent = `문제 ${qIndex+1} / ${TOTAL}`);
      hintBox.innerHTML="";
      hintIndex=0;
      addHint(q.hints[hintIndex]); // 기본 힌트 1개
      hintIndex=1;
      moreHintBtn && (moreHintBtn.disabled = (hintIndex >= q.hints.length));
      answerInput.value="";
      answerInput.disabled=false;
      submitBtn.disabled=false;
      skipBtn.disabled=false;
      nextRow.style.display="none";
      actionRow.style.display="flex";
      setTimeout(()=> answerInput.focus({preventScroll:true}), 10);
    }

    function addHint(text, kind){
      const d=document.createElement("div");
      d.className="hintItem" + (kind?(" "+kind):"");
      d.textContent = (kind==="correct" ? `✔ ${text}` :
                       kind==="wrong"   ? `✖ ${text}` : `• ${text}`);
      hintBox.appendChild(d);
      d.scrollIntoView({block:'nearest',behavior:'smooth'});
    }

    function showNextHintOneByOne(){
      const q = quizOrder[qIndex];
      if(!q) return;
      if(hintIndex < q.hints.length){
        addHint(q.hints[hintIndex]);
        hintIndex += 1;
        if(hintIndex >= q.hints.length) moreHintBtn.disabled = true;
      }
    }

    function isCorrect(user, q){
      const n = norm(user);
      const cands = [q.answer, ...(q.alts||[])];
      return cands.some(c => norm(c)===n);
    }

    function lockQuestion(){
      answerInput.disabled=true;
      submitBtn.disabled=true;
      skipBtn.disabled=true;
      actionRow.style.display="none";
      nextRow.style.display="flex";
      nextBtn && nextBtn.focus({preventScroll:true});
    }

    function onSubmit(){
      try{
        ensureAudio();
        const q = quizOrder[qIndex];
        if(!q){ finishLevel(); return; }
        const val = answerInput.value;
        if(!val){ answerInput.focus(); return; }
        if(isCorrect(val, q)){
          correct += 1;
          addHint(`정답! → ${q.answer}`, "correct");
          playCorrect();
        }else{
          addHint(`오답입니다. 정답은 “${q.answer}”`, "wrong");
          playWrong();
        }
        lockQuestion();
      }catch(err){ showError(err); }
    }
    function onSkip(){
      const q=quizOrder[qIndex];
      if(!q){ finishLevel(); return; }
      addHint(`정답 공개 → ${q.answer}`, "wrong");
      lockQuestion();
    }
    function nextQuestion(){
      qIndex += 1;
      if(qIndex >= TOTAL){ finishLevel(); } else { renderQuestion(); }
    }

    function finishLevel(){
      const pass = (correct>=Math.ceil(TOTAL*0.7));
      showScreen("result");
      resultTitle && (resultTitle.textContent = pass ? `LEVEL ${level} 통과!` : `LEVEL ${level} 실패`);
      resultDesc && (resultDesc.textContent = `정답 ${correct}/${TOTAL}` + (pass ? " — 다음 레벨로 진행할 수 있습니다." : " — 기준 미달로 기회 1회 차감."));
      nextLevelBtn && (nextLevelBtn.style.display = pass && level < 5 ? "block" : "none");
      if(pass){
        playLevelUp();
        level = Math.min(5, level+1);
      }else{
        attempts = Math.max(0, attempts-1);
        attemptsText && (attemptsText.textContent = attempts);
        attemptsText2 && (attemptsText2.textContent = attempts);
        if(attempts<=0){ tryRevive(); }
      }
    }

    // LAST NAME 복구
    function tryRevive(){
      ensureAudio();
      if(attempts>0) return;
      if(revivedUsed){ alert("남은 기회가 없습니다."); showScreen("home"); return; }
      const input = prompt("제작자의 'LAST NAME'을 영어로 적으시오.");
      if(input && norm(input)==="bae"){
        attempts=3;
        revivedUsed=true;
        alert("정답입니다. 기회 3회가 추가되었습니다.");
        attemptsText && (attemptsText.textContent = attempts);
        attemptsText2 && (attemptsText2.textContent = attempts);
        showScreen("home");
      }else{
        alert("오답입니다. 처음 화면으로 돌아갑니다.");
        showScreen("home");
      }
    }

    // 초기화
    showScreen("home");
  </script>
</body>
</html>
